```{R}
B=read.csv("athlete_events.csv")
```
```{R}

library(dplyr)
get_OldCode=function(Country,NOC){
    #Country=read.csv("CountryCode.csv")
    Code=Country$Code
    return(unlist(strsplit(Country[which(Country$Code==NOC),]$OldCode," ")))
}
Country=read.csv("CountryCode.csv")
#input selection
Season_sel=unique(B$Season)
NOC_sel=unique(B$NOC)
Sport_sel=unique(B$Sport)
Begin_Year_sel=unique(B$Year)
End_Year_sel=unique(B$Year)
Medal_sel=unique(B$Medal)
#example input
NOC="USA"
Season="Summer"
Sport=c("Shooting")
Begin_Year=1800
End_Year=2016
Medals=c("Silver","Gold","Bronze")


#output
Old_NOC=get_OldCode(Country,NOC)
Target_INFO=B[which(B$NOC==NOC | B$NOC==Old_NOC),]
Target_INFO=Target_INFO[which(Target_INFO$Season==Season & Target_INFO$Sport==Sport),]
View(Target_INFO)
#統計相同的Event且相同的Medal的合併和相同年分的總數
Result=Target_INFO%>%filter(Medal %in% Medals)%>%group_by(Year,Event,Medal) %>% summarise(Count = 1)
Result <- Result[which(Result$Year>=Begin_Year & Result$Year<=End_Year),]
#統計每年的Gold和Silver所選的獎牌數
Result=Result%>% filter(Medal %in% Medals)%>%group_by(Year,Medal) %>% summarise(Count = sum(Count))


```

```{R}
library(plotly)
#Gold -> #FFD700
#Silver -> #C0C0C0
#Bronze -> #CD7F32
#建立一個map

colors <- c("Gold" = "#FFD700", "Silver" = "#C0C0C0", "Bronze" = "#CD7F32")

if(length(Sport)<=4){
    Sport_text=paste(Sport,collapse=",")
}else{
    Sport_text="Multiple sports"
}

# 使用 plot_ly 绘图
p <- plot_ly(Result, x = ~Year, y = ~Count, color = ~Medal, colors = colors, type = 'bar') %>%
  layout(title = paste("\nCount of Medals", "in", NOC ,"(",Sport_text,")"),
         xaxis = list(title = 'Year'),
         yaxis = list(
            title = 'Count',
            tickvals = seq(0, max(Result$Count) + 1, by = 1)
            
        )
    )
        
  
p
```